<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <style>
      h1 {
        color: rgb(102, 0, 0);
        font-size: 50px;
        padding: 10px;

        text-align: center;
      }

      h2 {
        color: rgb(102, 0, 0);
        font-size: 70px;
        padding: 10px;
        text-align: center;
      }

      form {
        display: flex;
        flex-direction: column;
        width: 600px;
        margin: 0 auto;
        background-color: rgba(151, 0, 0, 0.253);
        color: rgb(99, 0, 0);
      }

      label {
        margin-top: 3px;
        font-weight: bold;
        color: rgb(117, 0, 0);
        margin: 0 auto;
      }

      input {
        padding: 8px;
        margin-top: 20px;
        border: 2px solid #7c0000;
        border-radius: 100px;
        font-size: 20px;
        margin: 0 auto;
      }

      button {
        margin-top: 40px;
        padding: 15px;
        background-color: rgb(102, 0, 0);
        color: rgb(255, 255, 255);
        border: 2px solid black;
        border-radius: 4px;
        text-shadow: rgb(0, 0, 0);
        margin: 0 auto;
      }

      button:hover {
        background-color: rgb(0, 0, 0);
      }
    </style>
 </head>

 <body>
   <h1>Vis√£o Geral</h1>

   <h2>‚ú®Vis√£o Geral dos usu√°rios‚ú®</h2>
   <div id="status">üôÑCarregando...</div>
   <div id="lista">
     <!--// A lista de usu√°rios ser√° inserida aqui  -->
   </div>

   <div>
     <button id="botaoAdicionarusuario" onclick="mostrarFormulario()">
       + Adicionar Pessoa
     </button>
   </div>

   <form id="formulario" style="display: none">
     <label> Nome: </label>
     <input type="text" id="nome" name="nome" required />

     <label> Login: </label>
     <input type="text" id="login" name="login" required />

     <label> Senha: </label>
     <input type="password" id="senha" name="senha" required />

     <button type="submit" onClick="adicionarPessoa()" required>
       Adicionar Pessoa
     </button>
   </form>

   <script>
     async function carregarPessoas() {
       const response = await fetch("/pessoas");

       console.log(response);

       const elemento = document.getElementById("status");
       if (!response.ok) {
         elemento.textContetnt = "N√£o foi poss√≠vel carregar as pessoas";
       }
       elemento.textContent = "Pessoas carregadas com sucesso";

       const pessoas = await response.json();
       console.log("\n Responses:", response, "\n Pessoas:", pessoas);

       const container = document.getElementById("lista");

       const ul = document.createElement("ul");
       ul.style.border = "2px solid red";

       const li = document.createElement("li");
       li.style.border = "2px solid blue";

       for (let c = 0; c < pessoas.length; c++) {
         const pessoa = pessoas[c];
         const texto = `NOME: ${pessoa.nome} -- ${pessoa.login} -- SENHA: ${pessoa.senha}`;

         const li = document.createElement("li");
         li.textContent = texto;
         ul.appendChild(li);

         const span = document.createElement("span");
         span.textContent = texto;

         const botao = document.createElement("button");
         botao.textContent = "X";
         botao.style.marginLeft = "10px";
         botao.onclick = () => deletarPessoa(pessoa.id, li);

         li.appendChild(span);
         li.appendChild(botao);
         ul.appendChild(li);
       }
       container.appendChild(ul);
     }
     carregarPessoas();

     function mostrarFormulario() {
       const formulario = document.getElementById("formulario");
       const botaoAdicionarusuario = document.getElementById(
         "botaoAdicionarusuario"
       );

       if (formulario.style.display === "none") {
         botaoAdicionarusuario.innerText = "Ocultar Formul√°rio";
         formulario.style.display = "block";
       } else {
         botaoAdicionarusuario.innerText = "Adicionar Pessoas";
         botaoAdicionarusuario.style.display = "none";
       }
     }

     function adicionarPessoa() {
       event.preventDefault();
       const nome = document.getElementById("nome").value.trim();
       const login = document.getElementById("login").value.trim();
       const senha = document.getElementById("senha").value.trim();

       console.log("NOME: ", nome, "\n LOGIN: ", login, "\n SENHA: ", senha);
       console.log("Adicionando pessoa...");

       if (!nome || !login || !senha) {
         alert("Por favor, preencha todos os campos.");
         return;
       }

       alert("Pessoa adicionada com sucesso!");
       document.getElementById("formulario").reset();

       const novaPessoa = { nome, login, senha };

       const container = document.getElementById("lista");
       let ul = container.querySelector("ul");

       if (!ul) {
         ul = document.createElement("ul");
         container.appendChild(ul);

         const li = document.createElement("li");
         li.textContent = `NOME: ${novaPessoa.nome} -- LOGIN: ${novaPessoa.login} -- SENHA: ${novaPessoa.senha}`;
         ul.appendChild(li);
       }
     }

     async function deletarPessoa(id, li) {
       console.log("Deletando pessoa com id:", id);

       const response = await fetch(`/pessoas/${id}`, {
         method: "DELETE",
       });

       if (response.ok) {
         alert("Pessoa deletada com sucesso!");
       li.remove();
       
       } else {
         alert("N√£o foi poss√≠vel deletar a pessoa.");
       }
     }
   </script>
 </body>
</html>
